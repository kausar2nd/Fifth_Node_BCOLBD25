<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXIREN - Fire Detection System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>üî• Fire Detection System</h1>
            <div class="system-status" id="systemStatus">
                <span class="status-indicator offline" id="statusIndicator"></span>
                <span id="statusText">System Offline</span>
            </div>
        </header>

        <main>
            <!-- Control Panel -->
            <section class="control-panel">
                <h2>Control Panel</h2>
                <div class="controls">
                    <button id="startBtn" class="btn btn-start">Start Monitoring</button>
                    <button id="stopBtn" class="btn btn-stop" disabled>Stop Monitoring</button>
                    <button id="stopAlarmBtn" class="btn btn-alarm" disabled>Stop Alarm</button>
                    <button id="settingsBtn" class="btn btn-settings">Settings</button>
                </div>
            </section>

            <!-- Monitoring Pipeline Status -->
            <section class="pipeline-status">
                <h2>Monitoring Pipeline Status</h2>
                <div class="pipeline-container">
                    <div class="pipeline-stage" id="stageSmoke">
                        <div class="stage-number">1</div>
                        <div class="stage-info">
                            <h4>Smoke Detection</h4>
                            <p>Continuous monitoring</p>
                        </div>
                        <div class="stage-status inactive" id="smokStageStatus">‚óè</div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="pipeline-stage" id="stageCamera">
                        <div class="stage-number">2</div>
                        <div class="stage-info">
                            <h4>Camera Verification</h4>
                            <p>Fire confirmation</p>
                        </div>
                        <div class="stage-status inactive" id="cameraStageStatus">‚óè</div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="pipeline-stage" id="stageTemp">
                        <div class="stage-number">3</div>
                        <div class="stage-info">
                            <h4>Temperature Fallback</h4>
                            <p>Backup verification</p>
                        </div>
                        <div class="stage-status inactive" id="tempStageStatus">‚óè</div>
                    </div>
                </div>
                <div class="current-stage-info">
                    <strong>Current Stage:</strong> <span id="currentStageDescription">System idle</span>
                </div>
            </section>

            <!-- Status Dashboard -->
            <section class="dashboard">
                <div class="dashboard-grid">
                    <!-- Video Feed -->
                    <div class="card video-card">
                        <h3>Live Camera Feed</h3>
                        <div class="video-container">
                            <img id="videoFeed" src="" alt="Camera feed will appear here" />
                            <div class="video-overlay" id="videoOverlay">
                                <span>Camera Offline</span>
                            </div>
                        </div>
                        <div class="camera-status">
                            <span id="cameraStatus">Offline</span>
                        </div>
                    </div>

                    <!-- Sensor Data -->
                    <div class="card sensors-card">
                        <h3>Sensor Readings</h3>
                        <div class="sensor-grid">
                            <div class="sensor-item">
                                <div class="sensor-icon">üí®</div>
                                <div class="sensor-data">
                                    <span class="sensor-label">Smoke Level</span>
                                    <span class="sensor-value" id="smokeLevel">0</span>
                                    <span class="sensor-unit">ppm</span>
                                </div>
                            </div>
                            <div class="sensor-item">
                                <div class="sensor-icon">üå°Ô∏è</div>
                                <div class="sensor-data">
                                    <span class="sensor-label">Temperature</span>
                                    <span class="sensor-value" id="temperature">0</span>
                                    <span class="sensor-unit">¬∞C</span>
                                </div>
                            </div>
                        </div>
                        <div class="esp32-status">
                            ESP32: <span id="esp32Status">Offline</span>
                        </div>
                    </div>

                    <!-- Alert Panel -->
                    <div class="card alert-card">
                        <h3>Alert Status</h3>
                        <div class="alert-content">
                            <div class="alert-indicator" id="alertIndicator">
                                <div class="alert-icon">üö®</div>
                                <div class="alert-text" id="alertText">No Alerts</div>
                            </div>
                            <div class="alert-details" id="alertDetails">
                                <p>System monitoring for fire hazards...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="card chart-card">
                        <h3>Real-time Data</h3>
                        <canvas id="sensorChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Log Panel -->
            <section class="log-panel">
                <h3>System Log</h3>
                <div class="log-container" id="logContainer">
                    <div class="log-entry">
                        <span class="log-time">[00:00:00]</span>
                        <span class="log-message">System initialized</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>System Settings</h2>
            <form id="settingsForm">
                <div class="form-group">
                    <label for="espIp">ESP32 IP Address:</label>
                    <input type="text" id="espIp" name="espIp" placeholder="192.168.0.111">
                </div>
                <div class="form-group">
                    <label for="smokeThreshold">Smoke Threshold (ppm):</label>
                    <input type="number" id="smokeThreshold" name="smokeThreshold" placeholder="2600">
                </div>
                <div class="form-group">
                    <label for="tempThreshold">Temperature Threshold (¬∞C):</label>
                    <input type="number" id="tempThreshold" name="tempThreshold" placeholder="60">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Settings</button>
                    <button type="button" id="closeModal" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>